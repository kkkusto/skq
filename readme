import os
import pandas as pd

# Function to add a 'duration_in_mins' column
def add_duration_in_mins(df, duration_col='Duration'):
    """
    Adds a new column 'duration_in_mins' to the DataFrame, converting time duration into minutes.
    
    Parameters:
    - df (pd.DataFrame): Input DataFrame containing the duration column.
    - duration_col (str): Name of the column with duration in 'HH:MM:SS' format.
    
    Returns:
    - pd.DataFrame: DataFrame with the new column 'duration_in_mins'.
    """
    def convert_to_minutes(duration):
        # Handle edge cases for missing or malformed data
        if not isinstance(duration, str):
            return None
        parts = duration.split(':')
        if len(parts) == 3:  # HH:MM:SS
            hours, minutes, seconds = map(int, parts)
            return hours * 60 + minutes + seconds / 60
        elif len(parts) == 2:  # MM:SS
            minutes, seconds = map(int, parts)
            return minutes + seconds / 60
        return None  # Return None for invalid formats

    df['duration_in_mins'] = df[duration_col].apply(convert_to_minutes)
    return df

# Directory containing the files
input_folder = 'path_to_your_folder'
output_folder = 'path_to_output_folder'
os.makedirs(output_folder, exist_ok=True)

# Iterate over all files in the input folder
for file_name in os.listdir(input_folder):
    if file_name.endswith('.csv'):  # Process only CSV files
        file_path = os.path.join(input_folder, file_name)
        
        try:
            # Read the CSV file into a DataFrame
            df = pd.read_csv(file_path)
            
            # Apply the duration conversion function
            df_modified = add_duration_in_mins(df, duration_col='Duration')
            
            # Generate the new file name and save the modified DataFrame
            modified_file_name = f"{os.path.splitext(file_name)[0]}_modified_30.csv"
            output_path = os.path.join(output_folder, modified_file_name)
            df_modified.to_csv(output_path, index=False)
            
            print(f"Processed and saved: {output_path}")
        except Exception as e:
            print(f"Error processing {file_name}: {e}")
